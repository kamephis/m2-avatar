<?php /** @var \Kamephis\Avatar\Block\Gravatar $block */ ?>

<style>
    .avatar-circle {
        display: inline-block;
        overflow: hidden;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        background: #1b721a;
        border: 1px solid #1e7c1d;
    }

    .avatar-circle img {
        display: block;
        max-width: 100%;
        height: auto;
    }

    .customer-info-wrapper{
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        margin: 10px 0 20px 0;
    }
</style>
<!--
<div class="customer-info-wrapper">
    <div class="avatar-wrapper">
        <div class="avatar-circle">
            <img src="<?php echo $block->escapeUrl($block->getGravatarUrl()); ?>" alt="User's gravatar">
        </div>
    </div>

    <div class="customer-info">
        <b>
        <?= $block->escapeUrl($block->customerHelper->getCustomerAttribute('firstname')); ?>
        <?= $block->escapeUrl($block->customerHelper->getCustomerAttribute('lastname')); ?>
        </b><br>
        <?= __('Last login: ');?>
        <?php echo $block->customerHelper->getCustomerLastLoginDate(); ?><br>
        <a href="<?= $block->getUrl('customer/account/logout'); ?>"><?= __('Sign Out') ?></a>
    </div>
</div>
-->

<div>
    <h2>Avatar</h2>
    <img data-bind="attr: {src: avatar_url}" alt="Avatar">
    <div data-bind="html: avatar_html"></div>
    <div data-bind="html: info_block"></div>
    <p>Last login date: <span data-bind="text: last_login_date"></span></p>
</div>

<script>
    require([
        'jquery',
        'knockout'
    ], function ($, ko) {
        $(function () {
            var viewModel = {
                avatar_url: ko.observable(''),
                avatar_html: ko.observable(''),
                info_block: ko.observable(''),
                last_login_date: ko.observable('')
            };
            $.ajax({
                url: '<?php echo $block->getUrl("kamephis_avatar/avatar/index") ?>',
                dataType: 'json',
                success: function (data) {
                    viewModel.avatar_url(data.avatar_url);
                    viewModel.avatar_html(data.avatar_html);
                    viewModel.info_block(data.info_block);
                    viewModel.last_login_date(data.last_login_date);
                }
            });
            ko.applyBindings(viewModel);
        });
    });
</script>
